/***需要删除的东西 **/
//     Mock.mock('/order/1/str', {
//         orders:[{
//             id: 1,
//             orderType : 1,
//             bulkId : 1,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30"
//         },{
//             id: 2,
//             orderType : 1,
//             bulkId : 2,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },{
//             id: 3,
//             orderType : 1,
//             bulkId : 3,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },{
//             id: 4,
//             orderType : 1,
//             bulkId : 41,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },{
//             id: 5,
//             orderType : 1,
//             bulkId : 51,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },{
//             id: 6,
//             orderType : 1,
//             bulkId : 61,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },{
//             id: 71,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },
//         {
//             id: 71,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },
//         {
//             id: 71,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },
//         {
//             id: 71,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },
//         {
//             id: 71,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },
//         {
//             id: 71,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },
//         {
//             id: 71,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },
//         {
//             id: 71,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         },
//         {
//             id: 71,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         }
//         ,
//         {
//             id: 771,
//             orderType : 1,
//             bulkId : 71,
//             bulkIndex : 1,
//             sendTime : "2016/10/23 11:30",
//             acceptTime : "2016/10/23 11:30",
//             enterQueueTime : "2016/10/23 11:30",
//             startPrintTime : "2016/10/23 11:30",

//             execSendTime : "2016/10/23 11:30",
//             execAcceptTime : "2016/10/23 11:30",
//             execEnterQueueTime : "2016/10/23 11:30",
//             execStartPrintTime : "2016/10/23 11:30",
//             execPrintResultTime : "2016/10/23 11:30"
//         }
//     ]
// });
/*****/

 function getCookis(name){
    var cookie_name = encodeURIComponent(name) + "=",
        cookie_start = document.cookie.indexOf(cookie_name),
        cookie_value = null,
        cookie_end = null;
    
    if(cookie_start > -1){
        cookie_end = document.cookie.indexOf(';', cookie_start);
        if(cookie_end == -1){
            cookie_end = document.cookie.length;
        }
        cookie_value = decodeURIComponent(document.cookie.substring(cookie_start + cookie_name.length, cookie_end));
    }
    
    return cookie_value;
}

var id = getCookis('user_id') || window.localStorage.getItem('smart_printer');
var vue = null;
if(!parseInt(id)){
    // alert('你还没登录');
    // window.location.href="../html/user_login.html";

}else{
    $('#search').click(function(event){
        var str = document.getElementById('order_id').value;
        if(str.match(/[0-9]/g)){
            send_order(str);
        }
    });
    function send_order(str){
        $.ajax({
            // url: '/order/' + id + '/' + str,
            type: 'get',
            dataType: 'json',
            success: function(data){
                // 成功处理时间
                success(data);
            },
            error: function(data){
                alert('系统出错');
            }
        });
    }
    function success(data){
        var str = "",
            order = data.order;
<<<<<<< HEAD
        if(order instanceof Array){
=======
>>>>>>> 5d9136db4d21f3074a453be1f0890a2d30cdd4f7
            for(var i = 0; i < order.length; i++){
                str = str + '<div class="one_status"><h1>订单ID：' + order[i].id +'</h1>' +
                            '<p>是否加急：' + (order[i].orderType === 0?'非加急':'加急') +'</p>' +
                            '<p>所在批次ID：' + order[i].bulkId + '</p>' +
                            '<p>所在批次编号：' + order[i].bulkIndex + '</p>' +
                            '<p>订单发送时间：' + order[i].sendTime + '</p>' +
                            '<p>订单接受时间：' + order[i].acceptTime + '</p>' +
                            '<p>订单进入打印队列时间：' + order[i].enterQueueTime + '</p>' +
                            '<p>订单打印结果时间：' + order[i].startPrintTime + '</p>' +
                            // 格式化为
                            '<p>错误订单重传时间：' + order[i].execSendTime + '</p>' +
                            '<p>错误订单接收时间：' + order[i].execAcceptTime + '</p>' +
                            '<p>错误订单进入打印队列时间：' + order[i].execEnterQueueTime + '</p>' +
                            '<p>错误订单开始打印时间：' + order[i].execStartPrintTime + '</p>' +
                            '<p>错误订单打印结果时间：' + order[i].execPrintResultTime + '</p>' +
                            '</div>';
            }
       
        $('#order_show').html(str);
    }
}

$.ajax({
    url : '/order/1/str',
    type: 'get',
    success: function(data){
        data = JSON.parse(data);
        var slice_data = [];
        for(var i = 0; i < data.orders.length /10 ; i++){
            slice_data.push([]);
            for(var j = 0; j < 10 && (i*10 + j) < data.orders.length; j++){
                try{
                data.orders[i * 10 + j].className = "";
                slice_data[i][j] = data.orders[i * 10 + j];
            }catch(err){
                console.log(i,j);
            }
            // slice_data.push([].concat(data.orders.slice(i*10, (i * 10 + 10) > data.orders.length? data.orders.length: i * 10 + 10)));
            // for(var k = 0; k < slice_data[i].length; k++){
            }
            slice_data[i].page = i + 1;
        }
        vue  = new Vue({
            el : '#get_order_search',
            data: {
                orders: slice_data,
                show_area: slice_data[0],
                page: 1,
                all_page: Math.ceil(data.orders.length / 10),
                find_order: null
            },
            methods: {
                change_page: function(index){
                    this.page = index + 1;
                    this.show_area = slice_data[index];
                },
                last_page: function(){
                    if(this.page <= 1){
                        alert('已经没有上一页了');
                        this.page = 1;
                    }else{
                        this.page = this.page - 1 ;
                        this.show_area = slice_data[this.page - 1];
                    }
                },
                next_page: function(){
                    if(this.page >= this.all_page){
                        alert('已经没有下一页了');
                        if(this.page === this.all_page){

                        }else{
                            this.page = this.all_page;
                            this.show_area = slice_data[this.page - 1];
                        }
                    }else{
                        this.page = this.page + 1 ;
                        this.show_area = slice_data[this.page - 1];
                    }
                }
                ,
                search_order: function() {
                    var str = document.getElementById('order_id').value;
                    if (str.match(/[0-9]/g)) {
                        for (var i = 0; i < this.all_page; i++) {
                            for (var j = 0; j < this.orders[i].length; j++) {
                                if (this.orders[i][j].id == str) {
                                    if (this.find_order) {
                                        // 如果存在之前的查找记录，那么清空
                                        this.find_order.className = "not";
                                    }
                                    this.page = this.orders[i].page;
                                    this.show_area = this.orders[this.page - 1];
                                    this.find_order = this.orders[i][j];
                                    this.find_order.className = "show_here";
                                    this.$nextTick(function () {
                                        // DOM 现在更新了
                                        // `this` 绑定到当前实例
                                        var ele = document.getElementById('order_id');
                                        if(ele.value){
                                        // 定位到这个地方
                                            window.scrollTo(0, document.getElementById('index'+ ele.value).offsetTop);
                                        }
                                    });
                                }
                            }
                        }
                    }
                }
            }
        });
    }

});

